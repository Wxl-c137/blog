---
layout: layout
title: HTTPS原理
date: 2020-04-04 13:38:15
categories:
  - - 前端
    - 计算机网络
tags:
  - https
  - 计算机网络
  - 通信加密
---

# https

https主要解决了web的信息安全问题。 因为http1.1中通信才用明文传输，很容易被截获利用，因此将重要信息进行加密传输避免的信息泄露。

---

## 常用的加密方法

#### 对称加密：

加密和机密使用的秘钥是一样的，通信双方使用的加密方法也是一样的，因此被称为对称加密。

​	**优点：运算速度快**

​	**缺点：因为加密需要使用同一秘钥，就必须将密匙发送给另一方。秘钥在传输过程中可能被截获，所以不安全**

![img](https://camo.githubusercontent.com/c95f015d173dd0dd54208f377c5ee9ba9e0d735f/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37666666613462382d623336642d343731662d616430632d6138386565373633626237362e706e67)



#### 非对称加密：

加密和解密有不同的密匙，加密使用公钥，解密使用私钥，不需要传递私钥就可以完成加密传输。

公开密钥所有人都可以获得，通信发送方获得接收方的公开密钥之后，就可以使用公开密钥进行加密，接收方收到通信内容后使用私有密钥解密。

非对称密钥除了用来加密，还可以用来进行签名。因为私有密钥无法被其他人获取，因此通信发送方使用其私有密钥进行签名，通信接收方使用发送方的公开密钥对签名进行解密，就能判断这个签名是否正确。

​	**优点：可以更加安全的将公开秘钥传输给通信发送方**

​	**缺点：非对称加密的算法相对复杂，运算速度不及对称加密**

![img](https://camo.githubusercontent.com/fe1d080a765b2285e0f91d882716c447ebf425f5/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f33396363623239392d656539392d346464312d623862342d3266396563393439356362342e706e67)

---



##  '中间人'攻击

非对称加密看似安全，但是黑客还是可以在传输中截获信息，冒充用户与服务端通信，再冒充服务端用用户通信，这样就能截获服务端和用户端的公钥进行解密了。

![img](https://upload-images.jianshu.io/upload_images/264052-c17453a8455daf75.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/882/format/webp)

---



## CA认证

中间人攻击的主要问题在于用户没办法认证服务端的身份。

### CA认证是如何保证服务器的真实身份的？



**1，保证证书的真实性**

**申请证书**：需要被验证的一端（通常是服务器），生成一份能够证明自己身份的证。**这张证书必须是由权威CA机构颁发的，且尚在有效期内；或者是一张信任的私人证书**。

服务器向CA机构提交自己的**信息**（如域名）和**公钥**（用户自己生成的非对称加密公钥，用于TLS握手阶段和另一端协商密钥用），CA机构生成数字证书，如下图：

![img](https://pic1.zhimg.com/80/v2-a07b55499fd8867d5be415ecc77001a0_720w.jpg)

**验证证书：**

收到对端发过来的证书，执行证书申请的“逆过程”即可，总结如下图：

![img](https://pic1.zhimg.com/80/v2-074ad85981131fca65cf2d03ac292700_720w.jpg)



![img](https://camo.githubusercontent.com/2901ef0e326dd93db4f6a815395fab9ff13225b2/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f323031372d30362d31312d63612e706e67)



**2.如何防止证书被篡改**

- 在传输之前先对证书进行hash运算。黑客无法逆向运算得到证书原信息。

- 将CA证书放置一份在本地环境中，本地证书不会再网络上传输，也就不会被篡改。
- 将本地证书的hash运算结果与服务器发来的数据进行比对，结果一直则证明服务器的证书是真实的。

## hash算法：

**安全散列算法**（英语：Secure Hash Algorithm，缩写为SHA），是一个[密码散列函数](https://baike.baidu.com/item/密码散列函数)家族，是[FIPS](https://baike.baidu.com/item/FIPS)所认证的安全[散列算法](https://baike.baidu.com/item/散列算法)。能计算出一个数字消息所对应到的，长度固定的字符串（又称消息摘要）的算法。且若输入的消息不同，它们对应到不同字符串的机率很高。

hash算法的特点是  无法通过秘钥反推明文。

---



## SSL和TLS协议

虽然保证了证书无法被篡改，但是还是有被监听的风险，因此https使用了TLS协议进行传输。

#### SSL(Secure Socket Layer 安全套接层)

基于HTTPS下的一个协议加密层，最初是由网景公司（Netscape）研发，后被IETF（The Internet Engineering Task Force - 互联网工程任务组）标准化后写入（RFCRequest For Comments 请求注释），RFC里包含了很多互

#### TLS(Transport Layer Security 安全传输层协议)

TLS就是SSL的新版本3.1，并同时发布“RFC2246-TLS加密协议详解”，如果想更深层次的了解TLS的工作原理可以去RFC的官方网站：www.rfc-editor.org，搜索RFC2246即可找到RFC文档！

### TLS传输过程

1. 客户单发起请求。发送支持ssl版本、非对称加密算法、随机数1
2. 服务端 回复确定ssl版本、对称加密算法、随机数2、ca证书
3. 客户端认证ca证书，认证成功后，返回随机数3、hash（随机数1、随机数2）
4. 服务端认证hash（随机数1、随机数2），使用随机数123+算法生成  对称加密秘钥
5. 生成hash（前三步数据），发送给客户端
6. 客户端认证hash（前三步数据），同样用随机数123+算法生成  对称加密秘钥。
7. 自此服务器和客户端都获得了对称加密的秘钥，接下来使用对称加密进行传输。

![image-20200326204634865](C:\Users\lulu\AppData\Roaming\Typora\typora-user-images\image-20200326204634865.png)

---



## https安全验证过程

HTTPS 采用混合的加密机制，正是利用了上面提到的方案：

- 使用非对称密钥加密方式，传输对称密钥加密方式所需要的 Secret Key，从而保证安全性;
- 获取到 Secret Key 后，再使用对称密钥加密方式进行通信，从而保证效率。（下图中的 Session Key 就是 Secret Key）

![img](https://camo.githubusercontent.com/370d97acbc36633fdd170957bbdcf8f8c91230ff/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f486f772d48545450532d576f726b732e706e67)